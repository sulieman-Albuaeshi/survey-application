{% load i18n %}
<div id="responses-overview-container" class="bg-white rounded-3xl border border-slate-200 shadow-sm overflow-hidden transition-all duration-300 hover:shadow-md">
    <!-- Header -->
    <div class="px-8 py-6 border-b border-slate-100 flex justify-between items-center bg-white">
        <div>
            <h2 class="text-xl font-bold text-slate-800 tracking-tight">{% trans "Responses Overview" %}</h2>
             <p class="text-sm text-slate-500 mt-1">{% trans "Matrix view of all given answers" %}</p>
        </div>
    </div>
    
    <div class="overflow-x-auto relative min-h-[300px]">
      <table class="table w-full border-collapse">
        <thead class="bg-slate-50/80 backdrop-blur-sm border-b border-slate-200 sticky top-0 z-10">
          <tr>
            <th class="px-6 py-5 text-left text-xs font-extrabold text-slate-500 uppercase tracking-wider">#</th>
            <th class="px-6 py-5 text-center text-xs font-extrabold text-slate-500 uppercase tracking-wider">
              {% trans "Respondent" %}
            </th>
            <!-- Date column removed as requested -->
            {% for question in questions %}
            <th
              class="px-4 py-5 text-center min-w-[80px]"
              title="{{ question.label }}"
            >
              <div class="flex flex-col items-center justify-center group/th cursor-help">
                <span class="text-primary/80 font-extrabold text-sm group-hover/th:text-primary transition-colors"
                  >{% trans "Q" %}{{ forloop.counter }}</span
                >
                <span class="text-[10px] text-slate-400 font-normal mt-0.5 max-w-[120px] truncate">{{ question.label }}</span>
              </div>
            </th>
            {% endfor %}
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-100 bg-white">
          {% for row in table_data %}
          <tr class="group hover:bg-slate-50 transition-all duration-200 ease-in-out border-l-4 rtl:border-l-0 rtl:border-r-4 ltr:border-l-transparent rtl:border-r-transparent ltr:hover:border-l-primary rtl:hover:border-r-primary hover:shadow-sm">
            <td
              class="px-6 py-4 font-bold text-slate-400 group-hover:text-primary transition-colors text-sm"
            >
              {{ page_obj.start_index|add:forloop.counter0 }}
            </td>
            <td class="px-6 py-5 text-center">
              <div class="flex items-center gap-4">
                {% if row.response.respondent %}
                  <div class="h-11 w-11 rounded-2xl bg-gradient-to-br from-primary to-primary-focus text-white flex items-center justify-center font-bold text-lg shadow-lg shadow-primary/20 ring-2 ring-white group-hover:scale-105 transition-transform duration-300">
                      {{ row.response.respondent.username|slice:":1"|upper }}
                  </div>
                  <div>
                      <p class="font-bold text-slate-800 text-sm mb-0.5">{{ row.response.respondent.username }}</p>
                      <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-slate-100 text-slate-600">
                          {% trans "Member" %}
                      </span>
                  </div>
                {% else %}
                  <div class="h-11 w-11 rounded-2xl bg-slate-200 text-slate-500 flex items-center justify-center shadow-inner ring-2 ring-white">
                      <i class="fa-solid fa-user-secret text-lg"></i>
                  </div>
                  <div>
                       <p class="font-bold text-slate-600 text-sm mb-0.5 italic">{% trans "Anonymous" %}</p>
                       <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-slate-100 text-slate-500">
                          {% trans "Guest" %}
                      </span>
                  </div>
                {% endif %}
              </div>
            </td>
            <!-- Date column removed -->
            {% for cell in row.cells %}
            <td class="p-3 align-top">
              {% if cell != "-" %}
              <div class="min-w-[140px] max-w-[400px] p-2 rounded-lg text-xs leading-relaxed bg-white border border-slate-200 text-slate-700 shadow-sm whitespace-normal break-words text-left mx-auto">
                {{ cell }}
              </div>
              {% else %}
              <div class="text-center py-2">
                <span class="text-slate-200 text-lg font-light">-</span>
              </div>
              {% endif %}
            </td>
            {% endfor %}
          </tr>
          {% empty %}
          <tr>
            <td
              colspan="{{ questions.count|add:2 }}" 
              class="text-center py-16"
            >
              <div class="flex flex-col items-center justify-center text-slate-400">
                <div class="h-16 w-16 bg-slate-50 rounded-full flex items-center justify-center mb-4 text-slate-300">
                   <i class="fa-solid fa-clipboard-question text-3xl"></i>
                </div>
                <p class="font-medium text-lg text-slate-600">{% trans "No responses yet" %}</p>
                 <p class="text-sm text-slate-400">{% trans "Once people start taking your survey, their responses will appear here." %}</p>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- HTMX Pagination (Styled for Overview) -->
    {% if page_obj.has_other_pages %}
    <div class="p-4 bg-slate-50/50 border-t border-slate-200">
      <div class="flex flex-col items-center justify-center gap-4">
          <div class="join shadow-sm border border-slate-200 rounded-xl bg-white">
              {% if page_obj.has_previous %}
                  <button
                      hx-get="{% url 'SurveyResponsesOverviewTable' survey.uuid %}?page={{ page_obj.previous_page_number }}"
                      hx-target="#responses-overview-container"
                      hx-swap="outerHTML"
                      class="join-item btn btn-sm btn-ghost hover:bg-slate-50 text-slate-600 font-medium px-4 w-12"
                  >
                      <i class="fa-solid fa-chevron-left rtl:rotate-180 text-xs"></i>
                  </button>
              {% else %}
                  <button class="join-item btn btn-sm btn-ghost disabled:bg-transparent disabled:text-slate-300 px-4 w-12" disabled>
                      <i class="fa-solid fa-chevron-left rtl:rotate-180 text-xs"></i>
                  </button>
              {% endif %}
              
              {% for num in page_obj.paginator.page_range %}
                  {% if page_obj.number == num %}
                      <button class="join-item btn btn-sm btn-primary text-white pointer-events-none">{{ num }}</button>
                  {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                      <button
                          hx-get="{% url 'SurveyResponsesOverviewTable' survey.uuid %}?page={{ num }}"
                          hx-target="#responses-overview-container"
                          hx-swap="outerHTML"
                          class="join-item btn btn-sm btn-ghost hover:bg-slate-50 text-slate-600 font-medium"
                      >
                          {{ num }}
                      </button>
                  {% endif %}
              {% endfor %}
              
              {% if page_obj.has_next %}
                  <button
                      hx-get="{% url 'SurveyResponsesOverviewTable' survey.uuid %}?page={{ page_obj.next_page_number }}"
                      hx-target="#responses-overview-container"
                      hx-swap="outerHTML"
                      class="join-item btn btn-sm btn-ghost hover:bg-slate-50 text-slate-600 font-medium px-4 w-12"
                  >
                       <i class="fa-solid fa-chevron-right rtl:rotate-180 text-xs"></i>
                  </button>
              {% else %}
                  <button class="join-item btn btn-sm btn-ghost disabled:bg-transparent disabled:text-slate-300 px-4 w-12" disabled>
                       <i class="fa-solid fa-chevron-right rtl:rotate-180 text-xs"></i>
                  </button>
              {% endif %}
          </div>
          <div class="text-xs text-slate-400 font-medium">
             {% trans "Page" %} {{ page_obj.number }} {% trans "of" %} {{ page_obj.paginator.num_pages }}
          </div>
      </div>
    </div>
    {% endif %}
</div>
