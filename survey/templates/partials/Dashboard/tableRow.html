{% load i18n %}
{% comment %} 
    context = {'survey': survey}
{% endcomment %}
<tr class="bg-white hover:bg-gray-50 border-b border-gray-100" id="survey-row-{{ survey.uuid }}">
    <td class="px-8 py-4 rtl:text-right font-medium text-gray-900 max-w-[200px]">
        <div class="truncate" title="{{ survey.title }}">
             {{ survey.title }}
        </div>
    </td>
    <td class="px-8 py-4 rtl:text-right text-gray-600 max-w-[300px]">
        <div class="line-clamp-2 text-ellipsis overflow-hidden" title="{{ survey.description }}">
            {{ survey.description }}
        </div>
    </td>
    <td class="px-8 py-4 text-center">
        <span id="survey-table-status-{{ survey.uuid }}" class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider {{ survey.status_badge_class }} ">{{ survey.get_state_display }}</span>
    </td>
    <!-- TODO -->
    <td class="px-8 py-4 text-center text-gray-600 font-medium pb-7">{{ survey.response_count }}</td>
    <td class="px-8 py-4 text-center text-gray-500 pb-7">{{ survey.last_updated|date:"M d, Y" }}</td>
    <!-- Dropdown menu -->
    <td class="px-8 py-4 text-center pb-7" x-data="{ open: false }">
        <div class="dropdown dropdown-left">
            <!-- 2. The trigger button needs a tabindex -->
            <div tabindex="0"
                 role="button"
                 class="inline-flex items-center p-2 text-sm font-medium text-center text-gray-500 hover:text-gray-800 bg-gray-100 hover:bg-gray-200 rounded-full focus:outline-none transition-colors">
                <svg class="w-5 h-5"
                     aria-hidden="true"
                     fill="currentColor"
                     viewbox="0 0 20 20"
                     xmlns="http://www.w3.org/2000/svg">
                    <path d="M6 10a2 2 0 11-4 0 2 2 0 014 0zM12 10a2 2 0 11-4 0 2 2 0 014 0zM16 12a2 2 0 100-4 2 2 0 000 4z" />
                </svg>
            </div>
            <!-- 3. The dropdown content itself. Note the new classes. -->
            <ul tabindex="0"
                class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-44">
                <li>
                    <a href="{% url 'SurveyResponseDetail' survey.uuid %}">{% trans "Show Responses" %}</a>
                </li>
                <li>
                    <a href="{% url 'SurveyPreview' survey.uuid %}" target="_blank" rel="noopener noreferrer">{% trans "Preview" %}</a>
                </li>
                {% if survey.state == 'published' %}
                <li x-data="{ copied: false, text: '/survey/{{survey.uuid}}' }">
                    <button @click="navigator.clipboard.writeText(window.location.origin + text); copied = true; setTimeout(() => copied = false, 2000)" class="text-left w-full">
                        <span x-show="!copied">{% trans "Copy Link" %}</span>
                        <span x-show="copied" class="text-green-600 font-bold flex items-center gap-2">
                            <i class="fa-solid fa-check"></i> {% trans "Copied!" %}
                        </span>
                    </button>
                </li>
                {% endif %}
                <li id="edit-survey-link-{{ survey.uuid }}">
                    <a href="{% url 'EditSurvey' survey.uuid %}" {% if survey.state == 'published' %}class="text-gray-400 pointer-events-none"{% endif %}>{% trans "Edit" %}</a>
                </li>
                <li>
                    <a href="{% url 'Copy' survey.uuid %}" >{% trans "Copy" %}</a>
                </li>
                <div class="divider my-0"></div>
                <li >
                    <button hx-post="{% url 'ToggleSurveyStatusConfirm' survey.uuid %}" hx-target="#modal-container"
                        hx-swap="innerHTML" >
                        {% if survey.state == 'published' %}{% trans "End Survey" %}{% elif survey.state == 'archived' %}{% trans "Restore" %}{% elif survey.state == 'draft' %}{% trans "Begin Survey" %}{% endif %}
                    </button>
                </li>
                <li>
                    <a class="text-red-500 hover:bg-red-50"
                        href="#"
                        hx-get="{% url 'DeleteSurveyConfirmModal' survey.uuid %}"
                        hx-target="#modal-container"
                        hx-swap="innerHTML">
                        {% trans "Delete" %}
                    </a>
                </li>
            </ul>
        </div>
    </td>
</tr>
