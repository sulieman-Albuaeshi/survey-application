{% extends "base.html" %}
{% load survey_extras %}
{% load static %}
{% load i18n %}

{% block navbar %}
<div class="navbar bg-white/90 backdrop-blur-md border-b border-slate-200 sticky top-0 z-50 justify-center h-16" x-data="{ scrolled: false }" @scroll.window="scrolled = (window.pageYOffset > 20)">
   <div class="flex items-center gap-2 transition-all duration-300" :class="{ 'scale-90': scrolled }">
       <!-- Clean Logo / Brand -->
       <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-primary to-primary-focus flex items-center justify-center text-white font-bold shadow-lg shadow-primary/30">
           <i class="fa-solid fa-square-check"></i>
       </div>
       <span class="text-xl font-bold text-slate-800 tracking-tight">koko <span class="text-primary">Survey</span></span>
   </div>
</div>
{% endblock %}

{% block content %}
<div x-data="{ 
    started: false, 
    page: 0, 
    total: {{ questions|group_by_sections:survey.shuffle_questions|length }} 
}" class="min-h-[calc(100vh-4rem)] bg-slate-50 font-sans selection:bg-primary/20 relative">

    <!-- Hero / Welcome Screen -->
    <div x-show="!started" 
         x-transition:leave="transition ease-in duration-300"
         x-transition:leave-start="opacity-100 scale-100"
         x-transition:leave-end="opacity-0 scale-95"
         class="absolute inset-0 flex flex-col items-center justify-center p-4 z-10 ">
         
         <div class="max-w-xl w-full bg-white/80 backdrop-blur-xl border border-white/60 shadow-xl shadow-slate-200/50 rounded-3xl p-8 md:p-12 text-center space-y-8 relative overflow-hidden ring-1 ring-slate-900/5">
             <!-- Decorator -->
             <div class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-primary/60 via-primary to-primary/60"></div>
             
             <!-- Content -->
             <div class="space-y-4 pt-2">
                 <h1 class="text-4xl md:text-5xl font-black text-slate-800 tracking-tight leading-tight">
                     {{ survey.title }}
                 </h1>
                 {% if survey.description %}
                 <p class="text-lg text-slate-500 leading-relaxed font-medium">
                     {{ survey.description }}
                 </p>
                 {% endif %}
             </div>

             <!-- Stats Pill -->
             <div class="inline-flex divide-x divide-slate-200 rounded-full border border-slate-200 bg-slate-50 p-2 shadow-sm">
                 <div class="px-6 py-1 text-center">
                     <div class="text-xs font-bold uppercase tracking-wider text-slate-400">{% trans "Questions" %}</div>
                     <div class="text-lg font-bold text-slate-700">{{ survey.real_question_count }}</div>
                 </div>
                 <div class="px-6 py-1 text-center">
                     <div class="text-xs font-bold uppercase tracking-wider text-slate-400">{% trans "Time" %}</div>
                     <div class="text-lg font-bold text-slate-700">~{{ survey.real_question_count }} {% trans "min" %}</div>
                 </div>
             </div>

             <!-- CTA -->
             <button @click="started = true; window.scrollTo({top: 0, behavior: 'smooth'})" 
                     class="btn btn-primary btn-lg w-full rounded-2xl shadow-lg shadow-primary/25 hover:shadow-primary/40 hover:-translate-y-1 transition-all duration-300 text-lg group h-14 border-0 bg-gradient-to-r from-primary to-primary-focus">
                 {% trans "Start Survey" %}
                 <i class="fa-solid fa-arrow-right rtl:-scale-x-100 ml-2 ltr:group-hover:translate-x-1 rtl:group-hover:-translate-x-1 transition-transform"></i>
             </button>
         </div>
         
         <div class="mt-12 opacity-60 hover:opacity-100 transition-opacity">
            <span class="text-slate-400 text-sm font-medium">{% trans "Powered by" %} <span class="text-primary font-bold">koko Survey</span></span>
         </div>
    </div>

    <!-- Questionnaire Flow -->
    <div x-show="started" 
         x-cloak
         style="display: none;" 
         x-transition:enter="transition ease-out delay-200 duration-500"
         x-transition:enter-start="opacity-0 translate-y-8"
         x-transition:enter-end="opacity-100 translate-y-0"
         class="py-12 px-4 sm:px-6 max-w-4xl mx-auto pb-32">
        
        <!-- Sticky Progress Bar -->
        <div class="fixed top-16 left-0 w-full z-40 bg-slate-100/50 backdrop-blur-sm h-1.5">
            <div class="h-full bg-primary transition-all duration-700 ease-out shadow-[0_0_10px_rgba(var(--p),0.5)]"
                :style="`width: ${((page + 1) / total) * 100}%`"></div>
        </div>

        <form method="POST" action="{% url 'survey_submit' survey.uuid %}" class="space-y-6"
            @keydown.enter="$event.target.tagName !== 'TEXTAREA' && $event.preventDefault()">
            {% csrf_token %}
            {% include "partials/survey_questions_display.html" %}
        </form>
    </div>
</div>
{% endblock %}
